## 2025-02-28 - Unsafe File Download via Unvalidated URL (SSRF Risk)
**Vulnerability:** The `download_file_from_gcs` function in `qwen3_embed/common/model_management.py` was vulnerable to Server-Side Request Forgery (SSRF) because it passed a user-provided URL directly to `requests.get` without validating the scheme or hostname. This allowed a malicious user to trigger requests to arbitrary internal network services.
**Learning:** SSRF vulnerabilities can arise when seemingly safe functions (like those meant for specific cloud providers) blindly trust user input to make external requests. Relying on default behavior (like `requests` refusing `file://` schemes) is insufficient for security; attackers can simply use `http` or `https` pointing to internal IPs.
**Prevention:** To prevent SSRF, explicitly validate both the URL scheme (e.g., restricting to `http` and `https`) and the hostname (e.g., using a strict allowlist like `storage.googleapis.com`) using `urllib.parse.urlparse` before making the request.
